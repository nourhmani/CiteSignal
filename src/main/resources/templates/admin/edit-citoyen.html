<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modifier le Citoyen - CiteSignal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary-color: #0ea5e9;
      --secondary-color: #3b82f6;
      --success-color: #10b981;
      --danger-color: #ef4444;
      --warning-color: #f59e0b;
      --dark-color: #1e293b;
      --light-bg: #f8fafc;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--light-bg);
      min-height: 100vh;
    }

    /* Top Navigation */
    .top-navbar {
      background: white;
      padding: 20px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }

    .navbar-brand {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .btn-back {
      padding: 10px 20px;
      background: var(--light-bg);
      color: var(--dark-color);
      border: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
    }

    .btn-back:hover {
      background: #e2e8f0;
      color: var(--dark-color);
    }

    /* Main Content */
    .main-content {
      padding: 0 30px;
    }

    .page-header {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }

    .breadcrumb {
      background: none;
      padding: 0;
      margin-bottom: 15px;
    }

    .breadcrumb-item {
      font-size: 14px;
      color: #64748b;
    }

    .breadcrumb-item.active {
      color: var(--primary-color);
      font-weight: 600;
    }

    .breadcrumb-item a {
      color: #64748b;
      text-decoration: none;
    }

    .breadcrumb-item a:hover {
      color: var(--primary-color);
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--dark-color);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    .page-title i {
      margin-right: 12px;
      color: var(--primary-color);
    }

    .page-subtitle {
      color: #64748b;
      font-size: 15px;
    }

    .form-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      margin-bottom: 30px;
    }

    .form-section {
      padding: 35px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--dark-color);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--light-bg);
      display: flex;
      align-items: center;
    }

    .section-title i {
      margin-right: 10px;
      color: var(--primary-color);
    }

    .form-label {
      color: var(--dark-color);
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    .form-label i {
      margin-right: 8px;
      color: var(--primary-color);
      font-size: 16px;
    }

    .required {
      color: var(--danger-color);
      margin-left: 4px;
      font-weight: 700;
    }

    .form-control, .form-select, .form-check-input {
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .form-control, .form-select {
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 15px;
      background: #f8fafc;
    }

    .form-control:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary-color);
      background: white;
      box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
    }

    .form-check-input:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .form-check-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(14, 165, 233, 0.25);
    }

    .form-text {
      color: #64748b;
      font-size: 13px;
      margin-top: 6px;
      display: flex;
      align-items: center;
    }

    .form-text i {
      margin-right: 6px;
      font-size: 12px;
    }

    .info-box {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.08), rgba(59, 130, 246, 0.08));
      border-left: 4px solid var(--primary-color);
      padding: 20px;
      border-radius: 12px;
      margin: 30px 0;
    }

    .info-box-content {
      display: flex;
      align-items: start;
      gap: 15px;
    }

    .info-icon {
      width: 45px;
      height: 45px;
      background: rgba(14, 165, 233, 0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .info-icon i {
      color: var(--primary-color);
      font-size: 20px;
    }

    .info-text strong {
      color: var(--dark-color);
      font-weight: 700;
      font-size: 15px;
      display: block;
      margin-bottom: 6px;
    }

    .info-text p {
      color: #475569;
      margin: 0;
      font-size: 14px;
      line-height: 1.6;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      padding: 25px 35px;
      background: var(--light-bg);
      border-top: 1px solid #e2e8f0;
    }

    .btn-cancel {
      padding: 14px 30px;
      background: white;
      color: var(--dark-color);
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      text-decoration: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-cancel:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      color: var(--dark-color);
    }

    .btn-submit {
      padding: 14px 30px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
    }

    .alert {
      padding: 16px 20px;
      border-radius: 12px;
      border: none;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .alert i {
      font-size: 20px;
    }

    .alert-success {
      background: #d1fae5;
      color: #065f46;
    }

    .alert-danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .warning-box {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(217, 119, 6, 0.08));
      border-left: 4px solid #f59e0b;
      padding: 20px;
      border-radius: 12px;
      margin: 30px 0;
    }

    .warning-box-content {
      display: flex;
      align-items: start;
      gap: 15px;
    }

    .warning-icon {
      width: 45px;
      height: 45px;
      background: rgba(245, 158, 11, 0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .warning-icon i {
      color: #d97706;
      font-size: 20px;
    }

    .warning-text strong {
      color: var(--dark-color);
      font-weight: 700;
      font-size: 15px;
      display: block;
      margin-bottom: 6px;
    }

    .warning-text p {
      color: #475569;
      margin: 0;
      font-size: 14px;
      line-height: 1.6;
    }

    .system-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .system-info-item {
      background: #f8fafc;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #e2e8f0;
    }

    .system-info-label {
      font-size: 12px;
      color: #64748b;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .system-info-label i {
      font-size: 14px;
    }

    .system-info-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--dark-color);
    }

    .badge-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .badge-status.active {
      background: #d1fae5;
      color: #065f46;
    }

    .badge-status.inactive {
      background: #fee2e2;
      color: #991b1b;
    }

    .badge-status.verified {
      background: #d1fae5;
      color: #065f46;
    }

    .badge-status.pending {
      background: #fef3c7;
      color: #92400e;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 0 15px;
      }

      .form-section {
        padding: 25px 20px;
      }

      .form-actions {
        flex-direction: column;
        padding: 20px;
      }

      .btn-cancel, .btn-submit {
        width: 100%;
        justify-content: center;
      }

      .page-header {
        padding: 20px;
      }

      .system-info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<!-- Top Navigation -->
<nav class="top-navbar">
  <div class="container-fluid px-4">
    <div class="d-flex justify-content-between align-items-center">
      <a class="navbar-brand" href="/dashboard">
        <i class="fas fa-city me-2"></i>CiteSignal
      </a>
      <a href="/user/admin/citoyens" class="btn-back">
        <i class="fas fa-arrow-left me-2"></i>Retour
      </a>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container-fluid px-4 main-content">
  <div class="page-header">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard"><i class="fas fa-home me-1"></i>Accueil</a></li>
        <li class="breadcrumb-item"><a href="/user/admin/citoyens">Citoyens</a></li>
        <li class="breadcrumb-item active">Modifier citoyen</li>
      </ol>
    </nav>
    <h1 class="page-title">
      <i class="fas fa-user"></i>
      Modifier le Citoyen
    </h1>
    <p class="page-subtitle">Modifiez les informations d'un citoyen existant</p>
  </div>

  <div class="form-card">
    <div class="form-section">
      <div th:if="${successMessage}" class="alert alert-success" role="alert">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
      </div>

      <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
      </div>

      <!-- Warning Box -->
      <div class="warning-box">
        <div class="warning-box-content">
          <div class="warning-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="warning-text">
            <strong>Attention : Modification de compte citoyen</strong>
            <p>Vous êtes sur le point de modifier un compte citoyen. Les modifications apportées affecteront l'accès de cet utilisateur à la plateforme. Soyez particulièrement attentif aux informations de contact et au statut du compte.</p>
          </div>
        </div>
      </div>

      <!-- Edit Form -->
      <form id="editCitoyenForm" th:action="@{/user/admin/edit-citoyen/{id}(id=${citoyen.id})}" method="post">
        <!-- CSRF Token -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <h3 class="section-title">
          <i class="fas fa-id-card"></i>
          Informations personnelles
        </h3>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="nom" class="form-label">
              <i class="fas fa-user"></i>
              Nom<span class="required">*</span>
            </label>
            <input type="text" class="form-control" id="nom" name="nom"
                   th:value="${citoyen.nom}"
                   placeholder="Dupont" required>
          </div>

          <div class="col-md-6 mb-3">
            <label for="prenom" class="form-label">
              <i class="fas fa-user"></i>
              Prénom<span class="required">*</span>
            </label>
            <input type="text" class="form-control" id="prenom" name="prenom"
                   th:value="${citoyen.prenom}"
                   placeholder="Jean" required>
          </div>
        </div>

        <h3 class="section-title" style="margin-top: 30px;">
          <i class="fas fa-address-book"></i>
          Informations de contact
        </h3>

        <div class="mb-3">
          <label for="email" class="form-label">
            <i class="fas fa-envelope"></i>
            Adresse email<span class="required">*</span>
          </label>
          <input type="email" class="form-control" id="email" name="email"
                 th:value="${citoyen.email}"
                 placeholder="jean.dupont@email.com" required>
          <small class="form-text">
            <i class="fas fa-info-circle"></i>
            L'adresse email sert d'identifiant de connexion
          </small>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="telephone" class="form-label">
              <i class="fas fa-phone"></i>
              Téléphone
            </label>
            <input type="tel" class="form-control" id="telephone" name="telephone"
                   th:value="${citoyen.telephone}"
                   placeholder="+216 XX XXX XXX">
          </div>

          <div class="col-md-6 mb-3">
            <label for="adresse" class="form-label">
              <i class="fas fa-map-marker-alt"></i>
              Adresse
            </label>
            <input type="text" class="form-control" id="adresse" name="adresse"
                   th:value="${citoyen.adresse}"
                   placeholder="Adresse complète">
          </div>
        </div>

        <h3 class="section-title" style="margin-top: 30px;">
          <i class="fas fa-user-check"></i>
          Statut du compte
        </h3>

        <div class="mb-3">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="active" name="active"
                   th:checked="${citoyen.active}" value="true">
            <label class="form-check-label" for="active">
              <strong>Compte actif</strong>
            </label>
            <div class="form-text">
              <i class="fas fa-info-circle"></i>
              Désactivez cette option pour suspendre temporairement l'accès du citoyen à la plateforme
            </div>
          </div>
        </div>

        <!-- Informations Système -->
        <h3 class="section-title" style="margin-top: 30px;">
          <i class="fas fa-cog"></i>
          Informations système
        </h3>

        <div class="system-info-grid">
          <div class="system-info-item">
            <div class="system-info-label">
              <i class="fas fa-user-tag"></i>
              Rôle
            </div>
            <div class="system-info-value" th:text="${citoyen.role.name()}">CITOYEN</div>
          </div>

          <div class="system-info-item">
            <div class="system-info-label">
              <i class="fas fa-calendar-plus"></i>
              Date d'inscription
            </div>
            <div class="system-info-value" th:text="${#temporals.format(citoyen.createdAt, 'dd/MM/yyyy')}">01/01/2024</div>
          </div>

          <div class="system-info-item">
            <div class="system-info-label">
              <i class="fas fa-check-circle"></i>
              Email vérifié
            </div>
            <div class="system-info-value">
              <span th:if="${citoyen.emailVerified != null && citoyen.emailVerified}" class="badge-status verified">
                <i class="fas fa-check"></i> Oui
              </span>
              <span th:unless="${citoyen.emailVerified != null && citoyen.emailVerified}" class="badge-status pending">
                <i class="fas fa-clock"></i> Non
              </span>
            </div>
          </div>

          <div class="system-info-item">
            <div class="system-info-label">
              <i class="fas fa-sign-in-alt"></i>
              Dernière connexion
            </div>
            <div class="system-info-value">
              <span class="text-muted">Non disponible</span>
            </div>
          </div>
        </div>

        <div class="info-box">
          <div class="info-box-content">
            <div class="info-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <div class="info-text">
              <strong>Sécurité et authentification</strong>
              <p>Le mot de passe reste inchangé lors de la modification des informations personnelles. Pour réinitialiser le mot de passe, demandez au citoyen d'utiliser la fonctionnalité "Mot de passe oublié" sur la page de connexion.</p>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="form-actions">
      <a href="/user/admin/citoyens" class="btn-cancel">
        <i class="fas fa-times"></i>
        Annuler
      </a>
      <button type="submit" class="btn-submit" form="editCitoyenForm">
        <i class="fas fa-save"></i>
        Enregistrer les modifications
      </button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Form submission handling
  document.querySelector('.btn-submit').addEventListener('click', function(e) {
    e.preventDefault();

    // Confirmation avant soumission
    if (confirm('Êtes-vous sûr de vouloir enregistrer les modifications ?')) {
      document.getElementById('editCitoyenForm').submit();
    }
  });
</script>
</body>
</html>