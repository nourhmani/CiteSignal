<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mes incidents - CiteSignal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1e293b;
            --light-bg: #f8fafc;
        }

        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--light-bg);
            min-height: 100vh;
        }

        .top-navbar {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .navbar-brand {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-back {
            padding: 10px 20px;
            background: var(--light-bg);
            color: var(--dark-color);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-back:hover {
            background: #e2e8f0;
            color: var(--dark-color);
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #64748b;
            font-size: 15px;
        }

        .filter-section {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .form-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 8px;
            display: block;
        }

        .form-select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            width: 100%;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            color: white;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--dark-color);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
            color: var(--dark-color);
        }

        .table-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .table {
            margin: 0;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table thead {
            background: var(--light-bg);
        }

        .table thead th {
            padding: 18px 20px;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #64748b;
            border: none;
        }

        .table tbody td {
            padding: 18px 20px;
            vertical-align: middle;
            color: var(--dark-color);
            border-top: 1px solid #f1f5f9;
        }

        .table tbody tr {
            transition: background 0.2s ease;
        }

        .table tbody tr:hover {
            background: #fafbfc;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-category {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
        }

        .badge-status-signale {
            background: #f1f5f9;
            color: #64748b;
        }

        .badge-status-pris-en-charge {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .badge-status-en-resolution {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-status-resolu {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-status-cloture {
            background: #e0e7ff;
            color: #3730a3;
        }

        .badge-priority-urgente {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-priority-haute {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-priority-moyenne {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .badge-priority-basse {
            background: #f1f5f9;
            color: #64748b;
        }

        .incident-link {
            color: var(--dark-color);
            font-weight: 600;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .incident-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-view {
            padding: 8px 12px;
            background: #dbeafe;
            color: #1d4ed8;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }

        .btn-view:hover {
            background: #bfdbfe;
            color: #1d4ed8;
        }

        .btn-edit {
            padding: 8px 12px;
            background: #fef3c7;
            color: #92400e;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }

        .btn-edit:hover {
            background: #fde68a;
            color: #92400e;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            border: none;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert i {
            font-size: 20px;
        }

        .alert-info {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .date-cell {
            font-size: 14px;
            color: #64748b;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .page-header {
                padding: 20px;
            }

            .filter-section {
                padding: 20px;
            }

            .table-container {
                overflow-x: auto;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-view, .btn-edit {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<nav class="top-navbar">
    <div class="container-fluid px-4">
        <div class="d-flex justify-content-between align-items-center">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-city me-2"></i>CiteSignal
            </a>
            <a href="/dashboard" class="btn-back">
                <i class="fas fa-arrow-left me-2"></i>Retour au dashboard
            </a>
        </div>
    </div>
</nav>

<div class="container-fluid px-4">
    <div class="page-header">
        <div>
            <h1 class="page-title">
                <i class="fas fa-list me-2" style="color: var(--primary-color)"></i>
                Mes incidents assignés
            </h1>
            <p class="page-subtitle">
                Gérez et suivez tous les incidents qui vous ont été assignés
            </p>
        </div>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <div class="filter-section">
        <form th:action="@{/agent/incidents}" method="get">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Statut</label>
                    <select name="status" class="form-select">
                        <option value="">Tous les statuts</option>
                        <option th:each="s : ${statuts}"
                                th:value="${s.name()}"
                                th:selected="${currentStatus == s.name()}"
                                th:text="${s}"></option>
                    </select>
                </div>
                <div class="col-md-12">
                    <div class="d-flex gap-3">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-filter"></i>
                            Filtrer
                        </button>
                        <a th:href="@{/agent/incidents}" class="btn-secondary">
                            <i class="fas fa-redo"></i>
                            Réinitialiser
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="table-container">
        <div th:if="${incidents.empty}" class="empty-state">
            <i class="fas fa-inbox"></i>
            <h4>Aucun incident assigné</h4>
            <p>Vous n'avez aucun incident assigné pour le moment.</p>
        </div>

        <div th:if="${!incidents.empty}">
            <table class="table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Titre</th>
                    <th>Catégorie</th>
                    <th>Statut</th>
                    <th>Priorité</th>
                    <th>Date de création</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="incident : ${incidents.content}">
                    <td>
              <span style="font-family: monospace; font-weight: 600; color: var(--dark-color)">
                #<span th:text="${incident.id}"></span>
              </span>
                    </td>
                    <td>
                        <a th:href="@{/incidents/{id}(id=${incident.id})}"
                           class="incident-link"
                           th:text="${incident.titre}"></a>
                    </td>
                    <td>
                        <span class="badge badge-category" th:text="${incident.categorie}"></span>
                    </td>
                    <td>
              <span th:switch="${incident.statut.name()}" class="badge">
                <span th:case="'SIGNALE'" class="badge-status-signale">
                  <i class="fas fa-flag"></i>
                  <span th:text="${incident.statut}"></span>
                </span>
                <span th:case="'PRIS_EN_CHARGE'" class="badge-status-pris-en-charge">
                  <i class="fas fa-user-check"></i>
                  <span th:text="${incident.statut}"></span>
                </span>
                <span th:case="'EN_RESOLUTION'" class="badge-status-en-resolution">
                  <i class="fas fa-tools"></i>
                  <span th:text="${incident.statut}"></span>
                </span>
                <span th:case="'RESOLU'" class="badge-status-resolu">
                  <i class="fas fa-check-circle"></i>
                  <span th:text="${incident.statut}"></span>
                </span>
                <span th:case="'CLOTURE'" class="badge-status-cloture">
                  <i class="fas fa-archive"></i>
                  <span th:text="${incident.statut}"></span>
                </span>
              </span>
                    </td>
                    <td>
              <span th:switch="${incident.priorite.name()}" class="badge">
                <span th:case="'URGENTE'" class="badge-priority-urgente">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span th:text="${incident.priorite}"></span>
                </span>
                <span th:case="'HAUTE'" class="badge-priority-haute">
                  <i class="fas fa-exclamation"></i>
                  <span th:text="${incident.priorite}"></span>
                </span>
                <span th:case="'MOYENNE'" class="badge-priority-moyenne">
                  <i class="fas fa-info-circle"></i>
                  <span th:text="${incident.priorite}"></span>
                </span>
                <span th:case="'BASSE'" class="badge-priority-basse">
                  <i class="fas fa-info"></i>
                  <span th:text="${incident.priorite}"></span>
                </span>
              </span>
                    </td>
                    <td class="date-cell">
                        <i class="fas fa-calendar me-2" style="color: #94a3b8"></i>
                        <span th:text="${#temporals.format(incident.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a th:href="@{/incidents/{id}(id=${incident.id})}"
                               class="btn-view"
                               title="Voir les détails">
                                <i class="fas fa-eye"></i>
                                Voir
                            </a>
                            <a th:href="@{/incidents/{id}/edit(id=${incident.id})}"
                               class="btn-edit"
                               title="Modifier l'incident">
                                <i class="fas fa-edit"></i>
                                Modifier
                            </a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- Pagination (si vous utilisez la pagination) -->
            <div th:if="${incidents.totalPages > 1}" class="p-4 border-top">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="text-muted">
                        Affichage de <span th:text="${incidents.number * incidents.size + 1}"></span>
                        à <span th:text="${Math.min((incidents.number + 1) * incidents.size, incidents.totalElements)}"></span>
                        sur <span th:text="${incidents.totalElements}"></span> incidents
                    </div>
                    <nav>
                        <ul class="pagination mb-0">
                            <li class="page-item" th:classappend="${incidents.first} ? 'disabled'">
                                <a class="page-link" th:href="@{/agent/incidents(size=${incidents.size}, page=${incidents.number})}"
                                   th:unless="${incidents.first}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                            <li class="page-item" th:each="page : ${#numbers.sequence(0, incidents.totalPages-1)}"
                                th:classappend="${page == incidents.number} ? 'active'">
                                <a class="page-link" th:href="@{/agent/incidents(size=${incidents.size}, page=${page})}"
                                   th:text="${page+1}"></a>
                            </li>
                            <li class="page-item" th:classappend="${incidents.last} ? 'disabled'">
                                <a class="page-link" th:href="@{/agent/incidents(size=${incidents.size}, page=${incidents.number+2})}"
                                   th:unless="${incidents.last}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>